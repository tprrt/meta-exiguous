#
# -*- coding: utf-8; tab-width: 4; c-basic-offset: 4; indent-tabs-mode: nil -*-

require conf/distro/poky.conf
require conf/distro/include/security_flags.inc

DISTRO = "exiguous"
DISTRO_NAME = "Exiguous based on Poky"
DISTROOVERRIDES = "poky:exiguous"

# -----------------------------------------------------------------------------
# Bitbake configuration
# -----------------------------------------------------------------------------

SDK_VENDOR = "-${DISTRO}ssdk"
SDK_NAME_PREFIX = "${DISTRO}"

MAINTAINER = "Thomas Perrot <thomas.perrot@tupi.fr>"

TARGET_VENDOR = "-${DISTRO}"

# -----------------------------------------------------------------------------
# Inherited distribution configuration
# -----------------------------------------------------------------------------

PACKAGE_CLASSES = "package_deb"

# USER_CLASSES = "image-mklibs image-prelink image-swab"

# -----------------------------------------------------------------------------
# Distribution configuration
# -----------------------------------------------------------------------------

# Toolchain configuration
# =============================================================================

# CFLAGS_append = " -O3"
# CXXFLAGS_append = " -O3"

# Main toolchain configuration
# TOOLCHAIN = "gcc"
# Use clang/llvm toolchain provide by meta-clang layer
# TOOLCHAIN = "clang"
# PREFERRED_PROVIDER_gcc-cross-initial-${TARGET_ARCH} = "${TOOLCHAIN}-cross-${TARGET_ARCH}"
# PREFERRED_PROVIDER_virtual/${TARGET_PREFIX}gcc-initial = "${TOOLCHAIN}-cross-${TARGET_ARCH}"
#
# Secondary toolchain configuration
# TOOLCHAIN_pn-<recipe-name> = "clang"
# DEPENDS_append_pn-<recipe-name> = "clang-cross-${TARGET_ARCH}"

# Libary configuration
# =============================================================================

# TCLIBC = "glibc"
# Use musl libc provide by meta-musl layer
# TCLIBC = "musl"
# PREFERRED_PROVIDER_virtual/libc = "${TCLIBC}"
# DISTRO_FEATURES_BACKFILL_CONSIDERED_append = " glibc"

# Kernel configuration
# =============================================================================

PREFERRED_PROVIDER_virtual/kernel = "linux-yocto"
PREFERRED_VERSION_linux-yocto = "3.14%"
PREFERRED_VERSION_linux-yocto_qemux86 = "3.14%"
PREFERRED_VERSION_linux-yocto_qemux86-64 = "3.14%"
PREFERRED_VERSION_linux-yocto_qemuarm = "3.14%"
PREFERRED_VERSION_linux-yocto_qemumips = "3.14%"
PREFERRED_VERSION_linux-yocto_qemumips64 = "3.14%"
PREFERRED_VERSION_linux-yocto_qemuppc = "3.14%"

# System configuration
# =============================================================================

# VIRTUAL-RUNTIME_login_manager ?= "busybox"
VIRTUAL-RUNTIME_login_manager = "toybox"
DISTRO_FEATURES_remove = "busybox"
DISTRO_FEATURES_BACKFILL_CONSIDERED_append = " busybox"

# VIRTUAL-RUNTIME_init_manager ?= "sysvinit"
VIRTUAL-RUNTIME_init_manager = "systemd"
DISTRO_FEATURES_remove = "sysvinit"
DISTRO_FEATURES_BACKFILL_CONSIDERED_append = " sysvinit"
VIRTUAL-RUNTIME_initscripts = ""

INHERIT += "extrausers"
EXTRA_USERS_PARAMS = "\
    usermod -p '$1$o1z3TKMG$v49npeAHkjaMoGkRIZVVJ1' root; \
"

DISTRO_EXTRA_RDEPENDS_append = " \
    kernel-modules \
    packagegroup-core-selinux \
    packagegroup-core-ssh-dropbear \
"

DISTRO_EXTRA_RRECOMMENDS_append = " kernel-module-af-packet"

DISTRO_FEATURES_append = " \
    acl xattr pam largefile tzdata \
    prelink zram \
    toybox systemd udev dbus udisks selinux \
    usbhost usbutils usbgadget \
    ipv6 iptables avahi \
    ntp dropbear nfs samba \
    useradd extrausers \
    cryptsetup pm-utils sysklogd cronie \
"

# Linguas
# =============================================================================

# TODO Move to image features ?

# IMAGE_LINGUAS = "en-us"
# ENABLE_BINARY_LOCALE_GENERATION = "1"
# LOCALE_UTF8_ONLY = "1"
# GLIBC_GENERATE_LOCALES = "en_US.UTF-8"

# -----------------------------------------------------------------------------
# Misc configurations
# -----------------------------------------------------------------------------

# QEMU_TARGETS ?= "arm i386 x86_64"

# XSERVER = ""

SANITY_TESTED_DISTROS += "Exiguous-* \n"

INHERIT += "distro_features_check"
